"use strict";(self["webpackChunktoutiao_m"]=self["webpackChunktoutiao_m"]||[]).push([[626],{4626:function(t,e,s){s.r(e),s.d(e,{default:function(){return $}});var r=function(){var t=this,e=t._self._c;return e("div",{staticClass:"search-container"},[e("form",{attrs:{action:"/"}},[e("van-search",{attrs:{background:"#3296Fa","show-action":"",placeholder:"请输入搜索关键词"},on:{search:t.onSearch,cancel:t.onCancel,focus:function(e){t.isResultShow=!1}},model:{value:t.searchText,callback:function(e){t.searchText=e},expression:"searchText"}})],1),t.isResultShow?e("SearchResult",{attrs:{searchText:t.searchText}}):t.searchText?e("SearchSuggestion",{attrs:{searchText:t.searchText},on:{search:t.onSearch}}):e("SearchHistroy",{attrs:{serchHistories:t.serchHistories},on:{clearAll:function(e){t.serchHistories=[]},search:t.onSearch,clearHistory:t.onClearHistory}})],1)},a=[],i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"search-histroy"},[e("van-cell",{attrs:{title:"搜素历史"},scopedSlots:t._u([{key:"right-icon",fn:function(){return[t.isDeleteShow?[e("span",{staticStyle:{"margin-right":"5px"},on:{click:function(e){return t.clearAll()}}},[t._v("全部删除")]),e("span",{on:{click:function(e){t.isDeleteShow=!1}}},[t._v("完成")])]:e("van-icon",{staticClass:"delete-icon",attrs:{name:"delete"},on:{click:function(e){t.isDeleteShow=!0}}})]},proxy:!0}])}),t._l(t.serchHistories,(function(s,r){return e("van-cell",{key:r,attrs:{title:s},on:{click:function(e){return t.onClearHistory(s,r)}},scopedSlots:t._u([t.isDeleteShow?{key:"right-icon",fn:function(){return[e("van-icon",{staticClass:"delete-icon",attrs:{name:"close"}})]},proxy:!0}:null],null,!0)})}))],2)},n=[],o={name:"SearchHistroy",props:{serchHistories:{type:Array,default:()=>[]}},data(){return{isDeleteShow:!1}},methods:{clearAll(){this.$emit("clearAll")},onClearHistory(t,e){this.isDeleteShow?this.$emit("clearHistory",e):this.$emit("search",t)}}},c=o,l=s(1001),h=(0,l.Z)(c,i,n,!1,null,"0d8e664e",null),u=h.exports,d=function(){var t=this,e=t._self._c;return e("div",{staticClass:"search-suggestion"},t._l(t.suggestionList,(function(s,r){return e("van-cell",{key:r,attrs:{icon:"search"},scopedSlots:t._u([{key:"title",fn:function(){return[e("span",{domProps:{innerHTML:t._s(t.highlight(s))}})]},proxy:!0}],null,!0)})})),1)},p=[],g=s(432),f=s(4806),S={name:"SearchSuggestion",props:{searchText:{type:String,default:""}},data(){return{suggestionList:[]}},watch:{searchText:{handler:(0,f.debounce)((function(t){this.loadSearchSuggestion(t)}),200),immediate:!0}},methods:{async loadSearchSuggestion(t){try{const{data:e}=await(0,g.hz)(t);console.log(e),e.data.options&&null==e.data.options[0]&&(e.data.options[0]=this.searchText),this.suggestionList=e.data.options}catch(e){this.$toast("获取列表失败")}},highlight(t){const e=`<span style="color:red">${this.searchText}</span>`;return t.split(this.searchText).join(e)}}},x=S,y=(0,l.Z)(x,d,p,!1,null,"03ba1cbe",null),T=y.exports,m=function(){var t=this,e=t._self._c;return e("div",{staticClass:"search-result"},[e("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了",error:t.error,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){t.error=e},load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.list,(function(t){return e("van-cell",{key:t.art_id,attrs:{title:t.title}})})),1)],1)},H=[],_={name:"SearchResult",props:{searchText:{type:String,default:""}},data(){return{page:1,perPage:20,list:[],loading:!1,finished:!1,error:!1}},methods:{async onLoad(){try{const{data:t}=await(0,g.Sx)({page:this.page,per_page:this.perPage,q:this.searchText});console.log(t.data.results),this.list.push(...t.data.results),this.loading=!1,t.data.results.length?this.page++:this.finished=!0}catch(t){this.error=!0,this.loading=!1,this.$toast("请求失败，请稍后重试")}}}},v=_,k=(0,l.Z)(v,m,H,!1,null,"3f65f0b9",null),w=k.exports,C=s(7247),b={name:"SearchIndex",components:{SearchHistroy:u,SearchSuggestion:T,SearchResult:w},data(){return{searchText:"",isResultShow:!1,serchHistories:(0,C.rV)("TOUTIAO_HISTORY")||[]}},watch:{serchHistories:{handler(t){(0,C.LS)("TOUTIAO_HISTORY",t)},deep:!0}},methods:{onSearch(t){this.searchText=t,this.isResultShow=!0,this.onAddTarget(t)},onAddTarget(t){const e=this.serchHistories.indexOf(t);-1!==e&&this.serchHistories.splice(e,1),this.serchHistories.unshift(t)},onClearHistory(t){this.serchHistories.splice(t,1)},onCancel(t){this.$toast("取消搜索"),this.$router.back()}}},A=b,R=(0,l.Z)(A,r,a,!1,null,"e1e4ae16",null),$=R.exports}}]);
//# sourceMappingURL=626.005381df.js.map